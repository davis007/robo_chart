## プロジェクト概要

KabuRoboは株の仮想売買バックテストシステムで、yfinanceを使用して株価データを取得し、指定した戦略に基づいて仮想売買を行う厳密なバックテストシステムです。

## Toolsにあるファイルの使い方

### 1. analyze_chart.py - 銘柄学習スクリプト

__使用方法:__

```bash
python tools/analyze_chart.py 9501.T --years 5 --min-years 3
```

__機能:__

- 244項目の特徴量を抽出（リターン、トレンド、ボラティリティ、オシレーター、キャンドル、出来高など）
- 過去5年間のデータを学習期間（4年）と検証期間（1年）に分割
- JSON形式でパラメータファイルを出力（params/ディレクトリに保存）

### 2. debug_analyze.py - デバッグ用分析スクリプト

__使用方法:__

```bash
python tools/debug_analyze.py 9984.T
```

__機能:__

- 特徴量計算のデバッグ用
- 各特徴量カテゴリごとに個別にテスト実行
- エラー発生時の詳細なトレースバック表示

### 3. debug_backtest.py - デバッグ用バックテストスクリプト

__使用方法:__

```bash
python tools/debug_backtest.py --symbol 9501.T --params params/9501.T.json --start 2024-01-01 --end 2024-12-31
```

__機能:__

- エントリー条件を緩和したバックテスト
- 複数シグナル一致方式（BUY: 2/3以上、SELL: 3/3以上）
- 詳細なデバッグ情報出力

## 銘柄学習方法

### 学習プロセス

1. __データ収集__: 過去5年間の株価データをyfinanceから取得
2. __期間分割__: 学習期間（4年）と検証期間（1年）に分割
3. __特徴量抽出__: 244項目の特徴量を計算
4. __パラメータ保存__: JSON形式でparams/ディレクトリに保存

### 特徴量カテゴリ

- __リターン系__ (54項目): 各期間のリターン統計
- __トレンド系__ (40項目): 移動平均、クロス回数
- __ボラティリティ系__ (24項目): ATR、ボリンジャーバンド
- __オシレーター系__ (22項目): RSI、RCI、ストキャスティクス
- __キャンドル系__ (30項目): 酒田パターン検出
- __出来高系__ (20項目): 出来高統計、OBV
- __連続性系__ (18項目): 連騰/連敗ストリーク
- __ドローダウン系__ (20項目): 最大DD、回復日数
- __レジーム系__ (16項目): ADX、季節性

## パラメーターセットしてdebug_backtest.pyを使う方法

### 1. パラメータファイルの作成

```bash
# 銘柄分析を実行してパラメータファイルを作成
python tools/analyze_chart.py 9984.T
```

### 2. debug_backtest.pyの実行

```bash
# 作成したパラメータファイルを使用してバックテスト実行
python tools/debug_backtest.py --symbol 9984.T --params params/9984.T.json --start 2024-01-01 --end 2024-12-31
```

### 3. パラメータファイルの構造

パラメータファイルは以下の構造を持ちます：

- `symbol`: 銘柄コード
- `span_years`: 分析年数
- `split`: 学習/検証期間分割情報
- `stats`: グローバル統計指標
- `features`: 244項目の特徴量
- `notes`: 観察メモ

### 4. デバッグバックテストの特徴

- __複数シグナル一致方式__: 5つのシグナルカテゴリからBUYは2/3以上、SELLは3/3以上で取引
- __詳細なログ出力__: 各シグナルの検出状況をリアルタイム表示
- __二段階損切り__: -5%で半分損切り、-8%で全額損切り
- __最低保有日数__: 3日間の最低保有期間設定

このシステムは教育・研究目的で設計されており、実際の投資には使用しないでください。
